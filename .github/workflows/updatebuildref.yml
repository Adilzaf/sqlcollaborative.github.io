name: update-build-ref

on: 
  deployment

jobs:
  updateref:
    runs-on: ubuntu-latest
    steps:
    - name: 'Checkout'
      uses: 'actions/checkout@v1'
    - name: 'Deployment pending'
      uses: 'deliverybot/status@master'
      with:
        state: 'pending'
        token: '${{ secrets.GITHUB_TOKEN }}'
    - name: create remote to dbatools
      shell: pwsh
      run: Invoke-WebRequest -Uri https://raw.githubusercontent.com/sqlcollaborative/dbatools/master/bin/dbatools-buildref-index.json -OutFile assets/dbatools-buildref-index.json
    - name: Commit changed file
      shell: pwsh
      run: if ( (git status --porcelain) -ne $null ){ git add .\assets\dbatools-buildref-index.json; git commit -m 'updating buildref file' }
