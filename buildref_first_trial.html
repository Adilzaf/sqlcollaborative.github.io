
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=2.0">
	<title>BuildRef example</title>
	<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" >
	<style>
		button.filter.pressed {
			border-color: red;
		}
	</style>
	<script type="text/javascript" language="javascript" src="//code.jquery.com/jquery-1.12.4.js" ></script>
	<script type="text/javascript" language="javascript" src="//cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
	
	<script type="text/javascript" language="javascript">
$(document).ready(function() {
	var t = $('#example').DataTable({
	"order": [0, 'desc'],
	"lengthMenu": [ [25, 50, 100, -1], [25, 50, 100, "All"] ],
	"pageLength": 100,
	"columnDefs": [
            {
                "targets": [ 0 ],
                "visible": false,
                "searchable": false
            }
        ]
	});
	$('button.filterName').on('click', function() {
		t.columns( 2 )
        .search( $(this).data('filtervalue') )
        .draw();
		$('button.filterName').removeClass('pressed')
		$(this).addClass('pressed');
		
	})
	$('button.filterSP').on('click', function() {
		if($(this).hasClass('pressed')) {
					$(this).removeClass('pressed')
					t.columns( 7 )
					.search("")
					.draw();
		} else {
			$(this).addClass('pressed')
			t.columns( 7 )
			.search( $(this).data('filtervalue') )
			.draw();
		}
	})
	$('button.filterCU').on('click', function() {
		if($(this).hasClass('pressed')) {
					$(this).removeClass('pressed')
					t.columns( 8 )
					.search("")
					.draw();
		} else {
			$(this).addClass('pressed')
			t.columns( 8 )
			.search( $(this).data('filtervalue') )
			.draw();
		}
	})
	$('button.filterLatestSP').on('click', function() {
		if($(this).hasClass('pressed')) {
					$(this).removeClass('pressed')
					t.columns( 9 )
					.search("")
					.draw();
		} else {
			$(this).addClass('pressed')
			t.columns( 9 )
			.search( $(this).data('filtervalue') )
			.draw();
		}
	})
	$('button.filterLatestCU').on('click', function() {
		if($(this).hasClass('pressed')) {
					$(this).removeClass('pressed')
					t.columns( 10 )
					.search("")
					.draw();
		} else {
			$(this).addClass('pressed')
			t.columns( 10 )
			.search( $(this).data('filtervalue') )
			.draw();
		}
	})
	$.ajax({
	  dataType: "json",
	  url: 'https://sqlcollaborative.github.io/assets/dbatools-buildref-index.json',
	  success: function (data) {
		var newarr = []
		var prevName = '.'
		var prevSP = '.'
		var prevCU = '.'
		var prevSupportedUntil = '.'
		var prevrow = null
		var results = [];
		$.each(data.Data, function(i, el) {
			var is_SP = '.'
			var is_CU = '.'
			var is_LatestSP = '.'
			var is_LatestCU = '.'
			if(el.Name && el.Name.length > 3) {
				if(el.Name != prevName) {
					prevName = el.Name
					prevSP = '.'
					prevCU = '.'
					is_LatestCU = 'X'
					prevSupportedUntil = '.'
				}
			}
			if(el.SP) {
				is_SP = 'X'
				var compareSP = ''
				if($.isArray(el.SP)) {
					compareSP = el.SP.join()
				} else {
					compareSP = el.SP
				}
				if(compareSP != prevSP) {
					prevSP = compareSP
					prevCU = '.'
					is_LatestCU = 'X'
					prevSupportedUntil = '.'
				}
			}
			if(el.CU && el.CU.length > 2) {
				is_CU = 'X'
				if(el.CU != prevCU) {
					prevCU = el.CU
				}
			}
			if(el.SupportedUntil && el.SupportedUntil.length > 2) {
				if(el.SupportedUntil != prevSupportedUntil) {
					prevSupportedUntil = el.SupportedUntil.substring(0,10)
				}
			}
			var nKBList = '.'
			if(el.KBList) {
				if($.isArray(el.KBList)) {
					var KBArr = []
					for(var i=0;i<el.KBList.length;i++) {
						KBArr.push('<a target="_blank" href="https://duckduckgo.com/?q=kb' + el.KBList[i] + '">KB' + el.KBList[i] + '</a>')
					}
					nKBList = KBArr.join()
				} else {
					nKBList = '<a target="_blank" href="https://duckduckgo.com/?q=kb' + el.KBList + '">KB' + el.KBList + '</a>'
				}
			}
			if (prevSP.indexOf('LATEST') !== -1) {
				is_LatestSP = 'X'
				prevSP = prevSP.replace(',LATEST', '')
			}
			if (is_LatestCU !== '.') {
				if(results.length > prevrow) {
					if (results[prevrow][4] !== '.') {
						results[prevrow][10] = 'X'
					}
				}
			}
			prevrow = i
			results.push(
				[i, el.Version, prevName, prevSP, prevCU, prevSupportedUntil, nKBList, is_SP, is_CU, is_LatestSP, '.']
			)
		})
		if(results[results.length-1][4] !== '.') {
			results[results.length-1][10] = 'X'
		}
		t.rows.add(results)
		t.draw(false)
	  }
	});
	
	
	
} );

	</script>
</head>
<body class="dt-example">
	<div class="container">
		<section>
			<h1>BuildRef example</h1>
			
			<div class="demo-html">
				<h5>Filter by SQL Version</h5>
				<button class="filter filterName" data-filtervalue="2000">2000</button>
				<button class="filter filterName" data-filtervalue="2005">2005</button>
				<button class="filter filterName" data-filtervalue="2008">2008</button>
				<button class="filter filterName" data-filtervalue="2008R2">2008R2</button>
				<button class="filter filterName" data-filtervalue="2012">2012</button>
				<button class="filter filterName" data-filtervalue="2014">2014</button>
				<button class="filter filterName" data-filtervalue="2016">2016</button>
				<button class="filter filterName" data-filtervalue="">All</button>
			</div>
			<div class="demo-html">
				<h5>Filter by Attributes</h5>
				<button class="filter filterSP" data-filtervalue="X">Filter for Service Packs</button>
				<button class="filter filterCU" data-filtervalue="X">Filter for CU</button>
				<button class="filter filterLatestSP" data-filtervalue="X">Filter for Latest SP</button>
				<button class="filter filterLatestCU" data-filtervalue="X">Filter for Latest CU</button>
			</div>
			<div class="demo-html">
			</div>
			<table id="example" class="display" cellspacing="0" width="100%">
				<thead>
					<tr>
						<th>Id</th>
						<th>Version</th>
						<th>Name</th>
						<th>SP</th>
						<th>CU</th>
						<th>End Of Support</th>
						<th>KB Ref</th>
						<th>is SP</th>
						<th>is CU</th>
						<th>is Latest SP</th>
						<th>is Latest CU</th>
					</tr>
				</thead>
				<tfoot>
					<tr>
						<th>Id</th>
						<th>Version</th>
						<th>Name</th>
						<th>SP</th>
						<th>CU</th>
						<th>End Of Support</th>
						<th>KB Ref</th>
						<th>is SP</th>
						<th>is CU</th>
						<th>is Latest SP</th>
						<th>is Latest CU</th>
					</tr>
				</tfoot>
			</table>
			
		</section>
	</div>
	<section>
	</section>
</body>
</html>